tm_shape(BoroughMapBNG) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
BroughBNGSF <- st_as_sf(BoroughMapBNG)
BroughOuter <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
WastepointSub <- WastepointBNG[BroughOuterSP,]
LondonWards@data <- data.frame(LondonWards@data,Pricedata[match(LondonWards@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
tm_shape(WardsOUT) +
tm_polygons(col = NA, alpha = 0.5) +
tm_shape(WastepointSub) +
tm_dots(col = "blue")
res <- poly.counts(WastepointSub, WardsOUT)
WardsOUT@data$WastepointCount<-res
WardsOUT@data$WasteDensity <- WardsOUT$WastepointCount/poly.areas(WardsOUT)
tm_shape(WardsOUT) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
WardsOUTSF <- st_as_sf(WardsOUT)
library(spdep)
coordsW <- coordinates(WardsOUT)
plot(coordsW)
LB_nb <- poly2nb(WardsOUT, queen=T)
#plot them
plot(LB_nb, coordinates(WardsOUT), col="red")
#add a map underneath
plot(WardsOUT, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
I_LWard_Global_Density <- moran.test(WardsOUT@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
C_LWard_Global_Density <- geary.test(WardsOUT@data$WasteDensity, Lward.lw)
C_LWard_Global_Density
G_LWard_Global_Density <- globalG.test(WardsOUT@data$WasteDensity, Lward.lw)
G_LWard_Global_Density
I_LWard_Global_Density <- moran.test(WardsOUT@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
LondonWards@data$WastepointCount<-res
LondonWards@data$WasteDensity <- LondonWards$WastepointCount/poly.areas(LondonWards)
LondonWards@data
tm_shape(LondonWards) +
tm_polygons("BlueDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Blue Plaque Density")
tm_shape(LondonWards) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Blue Plaque Density")
tm_shape(LondonWards) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Blue Plaque Density")
View(LondonWards)
res <- poly.counts(WastepointBNG, LondonWards)
LondonWards@data$WastepointCount<-res
LondonWards@data$WasteDensity <- LondonWards$WastepointCount/poly.areas(LondonWards)
tm_shape(LondonWards) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
coordsW <- coordinates(LondonWards)
plot(coordsW)
LB_nb <- poly2nb(LondonWards, queen=T)
#plot them
plot(LB_nb, coordinates(LondonWards), col="red")
#add a map underneath
plot(LondonWards, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
head(Lward.lw$neighbours)
I_LWard_Global_Density <- moran.test(LondonWards@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
res <- poly.counts(WastepointBNG, LondonWardsBNG)
LondonWardsBNG@data$WastepointCount<-res
LondonWardsBNG@data$WasteDensity <- LondonWardsBNG$WastepointCount/poly.areas(LondonWardsBNG)
tm_shape(LondonWardsBNG) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
coordsW <- coordinates(LondonWards)
plot(coordsW)
LB_nb <- poly2nb(LondonWards, queen=T)
#plot them
plot(LB_nb, coordinates(LondonWards), col="red")
#add a map underneath
plot(LondonWards, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
head(Lward.lw$neighbours)
I_LWard_Global_Density <- moran.test(LondonWards@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
C_LWard_Global_Density <- geary.test(LondonWards@data$WasteDensity, Lward.lw)
C_LWard_Global_Density
G_LWard_Global_Density <- globalG.test(LondonWards@data$WasteDensity, Lward.lw)
G_LWard_Global_Density
coordsW <- coordinates(LondonWards)
plot(coordsW)
LB_nb <- poly2nb(LondonWards, queen=T)
#plot them
plot(LB_nb, coordinates(LondonWards), col="red")
#add a map underneath
plot(LondonWards, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
I_LWard_Global_Density <- moran.test(LondonWards@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
G_LWard_Global_Density <- globalG.test(LondonWards@data$WasteDensity, Lward.lw)
G_LWard_Global_Density
coordsW <- coordinates(LondonWardsBNG)
plot(LondonWardsBNG)
LB_nb <- poly2nb(LondonWardsBNG, queen=T)
#plot them
plot(LB_nb, coordinates(LondonWardsBNG), col="red")
#add a map underneath
plot(LondonWardsBNG, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
I_LWard_Global_Density <- moran.test(LondonWardsBNG@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
G_LWard_Global_Density <- globalG.test(LondonWardsBNG@data$WasteDensity, Lward.lw)
G_LWard_Global_Density
C_LWard_Global_Density <- geary.test(LondonWardsBNG@data$WasteDensity, Lward.lw)
C_LWard_Global_Density
newvar<-0
attach(LondonWardsBNG)
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-TRUE
newvar[variable==0]<-FALSE
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
WithWaste <- subset(WardsOUTSF, WastepointCount_recode > 0, select = c(NAME, Value,WastepointCount))
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-TRUE
newvar[variable==0]<-FALSE
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
WithWaste <- subset(LondonWardsSF, WastepointCount_recode > 0, select = c(NAME, Value,WastepointCount))
View(LondonWardsSF)
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-TRUE
newvar[variable==0]<-FALSE
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
tm_shape(WardsOUT) +
tm_polygons(col = NA, alpha = 0.5) +
tm_shape(WastepointSub) +
tm_dots(col = "blue")
WithWaste <- subset(LondonWardsSF, WastepointCount_recode > 0, select = c(NAME, Value,WastepointCount))
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-TRUE
newvar[variable==0]<-FALSE
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
tm_shape(WardsOUT) +
tm_polygons(col = NA, alpha = 0.5) +
tm_shape(WastepointSub) +
tm_dots(col = "blue")
WithWaste <- subset(LondonWardsSF, WastepointCount_recode > 0, select = c(NAME, Value,WastepointCount))
WithoutWaste<- subset(LondonWardsSF, WastepointCount_recode < 1, select = c(NAME, Value))
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-"Yes"
newvar[variable==0]<-"No"
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
BroughInnerSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Inner London'),]
BroughInnerSP <- as(BroughInnerSF,"Spatial")
BroughInnerSP <- spTransform(BroughInnerSP,BNG)
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
WardsInner <- LondonWardsBNG[BroughInnerSP,]
tm_shape(WardsOUT) +
tm_polygons(col = NA, alpha = 0.5) +
tm_shape(WastepointSub) +
tm_dots(col = "blue")
chisq<-chisq.test(WardsInner$WastepointCount_recode,WardsOUT$WastepointCount_recode)
library(spatstat)
library(sp)
library(rgeos)
library(maptools)
library(GISTools)
library(tmap)
library(sf)
library(geojsonio)
library(tmaptools)
library(raster)
library(fpc)
library(plyr)
library(OpenStreetMap)
library(rgdal)
library(tidyverse)
library(broom)
library(ggplot2)
BoroughMapSF <- read_shape("BoundaryData/england_lad_2011.shp", as.sf = TRUE)
I_O_brough <- read.csv('Inner_Outer.csv')
names(I_O_brough) <- c("Code", "Inner_Outer")
BoroughMapSF <- merge(BoroughMapSF, I_O_brough, by.x = "code", by.y = "Code")
LondonWards <- readOGR("WardsData/London_Ward_CityMerged.shp", layer="London_Ward_CityMerged")
BoroughMap <- as(BoroughMapSF, "Spatial")
Wastepoint <- geojson_read("point.geojson", what = "sp")
Pricedata <- read.csv('PriceData.csv')
library(spatstat)
library(sp)
library(rgeos)
library(tmap)
library(sf)
library(geojsonio)
library(tmaptools)
library(raster)
library(fpc)
library(plyr)
library(OpenStreetMap)
library(rgdal)
library(tidyverse)
library(broom)
library(ggplot2)
library(spatstat)
library(sp)
library(rgeos)
library(maptools)
library(GISTools)
library(tmap)
library(sf)
library(geojsonio)
library(tmaptools)
library(raster)
library(fpc)
library(plyr)
library(OpenStreetMap)
library(rgdal)
library(tidyverse)
library(broom)
library(ggplot2)
BoroughMapSF <- read_shape("BoundaryData/england_lad_2011.shp", as.sf = TRUE)
I_O_brough <- read.csv('Inner_Outer.csv')
names(I_O_brough) <- c("Code", "Inner_Outer")
BoroughMapSF <- merge(BoroughMapSF, I_O_brough, by.x = "code", by.y = "Code")
LondonWards <- readOGR("WardsData/London_Ward_CityMerged.shp", layer="London_Ward_CityMerged")
BoroughMap <- as(BoroughMapSF, "Spatial")
Wastepoint <- geojson_read("point.geojson", what = "sp")
Pricedata <- read.csv('PriceData.csv')
tmap_mode('view')
summary(Wastepoint)
BNG = "+init=epsg:27700"
WGS = "+init=epsg:4326"
LondonWardsBNG <- spTransform(LondonWards,BNG)
BoroughMapBNG <- spTransform(BoroughMap,BNG)
WastepointBNG <- spTransform(Wastepoint, BNG)
tm_shape(BoroughMapBNG) +
tm_polygons(col = NA, alpha = 1.0) +
tm_shape(WastepointBNG) +
tm_dots(col = "blue")
#Here we can find some points lay out the boundaries, thus we need clip the points to make all points are in boundary.
WastepointBNG <- WastepointBNG[BoroughMapBNG,]
summary(Wastepoint)
tm_shape(BoroughMapBNG) +
tm_polygons(col = NA, alpha = 0.5) +
tm_shape(WastepointBNG) +
tm_dots(col = "blue")
res <- poly.counts(WastepointBNG, BoroughMapBNG)
BoroughMapBNG@data$WastepointCount<-res
BoroughMapBNG@data$WasteDensity <- BoroughMapBNG$WastepointCount/poly.areas(BoroughMapBNG)
BoroughMapBNG@data
tm_shape(BoroughMapBNG) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
BroughBNGSF <- st_as_sf(BoroughMapBNG)
res <- poly.counts(WastepointBNG, LondonWardsBNG)
LondonWardsBNG@data$WastepointCount<-res
LondonWardsBNG@data$WasteDensity <- LondonWardsBNG$WastepointCount/poly.areas(LondonWardsBNG)
tm_shape(LondonWardsBNG) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
res <- poly.counts(WastepointBNG, LondonWardsBNG)
LondonWardsBNG@data$WastepointCount<-res
LondonWardsBNG@data$WasteDensity <- LondonWardsBNG$WastepointCount/poly.areas(LondonWardsBNG)
tm_shape(LondonWardsBNG) +
tm_polygons("WasteDensity",
style="jenks",
palette="PuOr",
midpoint=NA,
title="Waste Point Density")
coordsW <- coordinates(LondonWardsBNG)
plot(LondonWardsBNG)
LB_nb <- poly2nb(LondonWardsBNG, queen=T)
library("GISTools", lib.loc="~/R/win-library/3.5")
coordsW <- coordinates(LondonWardsBNG)
plot(LondonWardsBNG)
LB_nb <- poly2nb(LondonWardsBNG, queen=T)
library("maptools", lib.loc="~/R/win-library/3.5")
coordsW <- coordinates(LondonWardsBNG)
plot(LondonWardsBNG)
LB_nb <- poly2nb(LondonWardsBNG, queen=T)
library(spatstat)
library(sp)
library(rgeos)
library(maptools)
library(GISTools)
library(tmap)
library(sf)
library(geojsonio)
library(tmaptools)
library(raster)
library(fpc)
library(plyr)
library(OpenStreetMap)
library(rgdal)
library(tidyverse)
library(broom)
library(ggplot2)
library(spatstat)
library(sp)
library(rgeos)
library(maptools)
library(GISTools)
library(tmap)
library(sf)
library(geojsonio)
library(tmaptools)
library(raster)
library(fpc)
library(plyr)
library(OpenStreetMap)
library(rgdal)
library(tidyverse)
library(broom)
library(ggplot2)
library(spdep)
coordsW <- coordinates(LondonWardsBNG)
plot(LondonWardsBNG)
LB_nb <- poly2nb(LondonWardsBNG, queen=T)
#plot them
plot(LB_nb, coordinates(LondonWardsBNG), col="red")
#add a map underneath
plot(LondonWardsBNG, add=T)
Lward.lw <- nb2listw(LB_nb, style="C")
I_LWard_Global_Density <- moran.test(LondonWardsBNG@data$WasteDensity, Lward.lw)
I_LWard_Global_Density
G_LWard_Global_Density <- globalG.test(LondonWardsBNG@data$WasteDensity, Lward.lw)
G_LWard_Global_Density
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-"Yes"
newvar[variable==0]<-"No"
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuter,"Spatial")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuterSF,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
BroughInnerSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Inner London'),]
BroughInnerSP <- as(BroughInnerSF,"Spatial")
BroughInnerSP <- spTransform(BroughInnerSP,BNG)
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
WardsInner <- LondonWardsBNG[BroughInnerSP,]
chisq<-chisq.test(WardsInner$WastepointCount_recode,WardsOUT$WastepointCount_recode)
model1 <- lm(log(Value) ~ WastepointCount, data = WardsOUTSF)
model1_res <- tidy(model1)
summary(model1)
model1 <- lm(log(Value) ~ WastepointCount, data = WardsOUTSF)
WardsOUTSF=st_as_sf(WardsOUT)
model1 <- lm(log(Value) ~ WastepointCount, data = WardsOUTSF)
summary(model1)
summary(model1)
model1 <- lm(log(Value) ~ WastepointCount_recode, data = WardsOUTSF)
WardsOUTSF=st_as_sf(WardsOUT)
summary(model1)
model1 <- lm(log(Value) ~ WasteDensity, data = WardsOUTSF)
summary(model1)
model1 <- lm(log(Value) ~ WasteDensity, data = WardsOUT)
model1_res <- tidy(model1)
summary(model1)
model1 <- lm(log(Value) ~ WastepointCount, data = WardsOUT)
model1_res <- tidy(model1)
summary(model1)
model1 <- lm(log(Value) ~ WastepointCount, data = WardsOUT)
model1_res <- tidy(model1)
summary(model1)
WardsOUTSF$model_final_res <- model1$residuals
qtm(LondonWardsSF, fill = "model_final_res")
qtm(WardsOUTSF, fill = "model_final_res")
WithWaste <- subset(WardsOUTSF, WastepointCount_recode > 0, select = c(NAME, Value,WastepointCount,WasteDensity))
model1 <- lm(log(Value) ~ WastepointCount, data = WithWaste)
model1_res <- tidy(model1)
summary(model1)
WithWaste$model_final_res <- model1$residuals
qtm(WithWaste, fill = "model_final_res")
View(WithWaste)
WithWaste <- subset(WardsOUTSF, WastepointCount_recode== "Yes", select = c(NAME, Value,WastepointCount,WasteDensity))
model1 <- lm(log(Value) ~ WastepointCount, data = WithWaste)
model1_res <- tidy(model1)
summary(model1)
WithWaste$model_final_res <- model1$residuals
qtm(WithWaste, fill = "model_final_res")
WithoutWaste<- subset(LondonWardsSF, WastepointCount_recode== "No", select = c(NAME, Value))
WithoutWaste<- subset(WardsOUTSF, WastepointCount_recode== "No", select = c(NAME, Value))
t.test(WithWaste$Value,WithoutWaste$Value,paired = F)
newvar<-0
LondonWardsSF <- st_as_sf(LondonWardsBNG)
attach(LondonWardsSF)
newvar<-0
recode<-function(variable){
newvar[variable>0]<-T
newvar[variable==0]<-F
return(newvar)
}
LondonWardsBNG$WastepointCount_recode <- recode(WastepointCount)
tm_shape(LondonWardsBNG) +
tm_polygons("WastepointCount_recode")
names(Pricedata) <- c("Code", "Value")
Pricedata$Value <- as.numeric(Pricedata$Value)
BroughOuterSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Outer London'),]
BroughOuterSP <- as(BroughOuterSF,"Spatial")
BroughOuterSP <- spTransform(BroughOuterSP,BNG)
BroughInnerSF <- BroughBNGSF[which(BroughBNGSF$Inner_Outer =='Inner London'),]
BroughInnerSP <- as(BroughInnerSF,"Spatial")
BroughInnerSP <- spTransform(BroughInnerSP,BNG)
LondonWardsBNG@data <- data.frame(LondonWardsBNG@data,Pricedata[match(LondonWardsBNG@data[,"GSS_CODE"],Pricedata[,"Code"]),])
WardsOUT <- LondonWardsBNG[BroughOuterSP,]
WardsInner <- LondonWardsBNG[BroughInnerSP,]
WardsOUTSF=st_as_sf(WardsOUT)
chisq<-chisq.test(WardsInner$WastepointCount_recode,WardsOUT$WastepointCount_recode)
